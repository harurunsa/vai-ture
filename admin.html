<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAI Ad Network - åº—èˆ—ç®¡ç†ç”»é¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-10">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-6 text-gray-800">âš¡ VAI Ad Network ç®¡ç†ç”»é¢</h1>
        
        <form id="shopForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">åº—èˆ—ID (åŠè§’è‹±æ•°å­—)</label>
                <input type="text" id="shopId" placeholder="ä¾‹: my_shop_001" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">åº—èˆ—å (AIã«è¡¨ç¤ºã•ã‚Œã¾ã™)</label>
                <input type="text" id="shopName" placeholder="ä¾‹: æ¸‹è°· ç„¼è‚‰VAI" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">äºˆç´„ãƒšãƒ¼ã‚¸URL (æœ€çµ‚ç›®çš„åœ°)</label>
                <input type="url" id="shopUrl" placeholder="https://..." class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">1ã‚¯ãƒªãƒƒã‚¯ã‚ãŸã‚Šã®å…¥æœ­å˜ä¾¡ (CPC)</label>
                <div class="flex items-center mt-1">
                    <span class="mr-2">Â¥</span>
                    <input type="number" id="cpcBid" value="50" min="10" class="block w-full border border-gray-300 rounded-md p-2" required>
                </div>
                <p class="text-xs text-gray-500 mt-1">â€»å˜ä¾¡ã‚’é«˜ãè¨­å®šã™ã‚‹ã»ã©ã€AIã‹ã‚‰ã®æ¨è–¦ç¢ºç‡ãŒä¸ŠãŒã‚Šã¾ã™ã€‚</p>
            </div>
            
            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700">
                åº—èˆ—ã‚’ç™»éŒ²ãƒ»æ›´æ–°ã™ã‚‹
            </button>
        </form>

        <div id="tagSection" class="mt-10 hidden border-t pt-6">
            <h2 class="text-lg font-bold text-gray-800 mb-2">ğŸ‰ ç™»éŒ²å®Œäº†ï¼</h2>
            <p class="text-sm text-gray-600 mb-4">ä»¥ä¸‹ã®ã€ŒVAIã‚¿ã‚°ã€ã‚’ã€ã‚ãªãŸã®ã‚µã‚¤ãƒˆï¼ˆShopifyç­‰ï¼‰ã® <code>&lt;head&gt;</code> å†…ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ã“ã‚Œã§AIå¯¾ç­–ã¨è¿½è·¡ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚</p>
            
            <div class="bg-gray-800 rounded-md p-4 relative">
                <code id="tagCode" class="text-green-400 text-sm break-all"></code>
            </div>
        </div>
    </div>

    <script>
        // ã‚ãªãŸã®Workerã®URLã«æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼ˆæœ€å¾Œã¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ãªã—ï¼‰
        const WORKER_URL = "https://vai-ture.yamashitahiro0628.workers.dev";

        document.getElementById('shopForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const shopData = {
                id: document.getElementById('shopId').value,
                name: document.getElementById('shopName').value,
                url: document.getElementById('shopUrl').value,
                cpc_bid: parseInt(document.getElementById('cpcBid').value)
            };

            try {
                // APIã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
                const response = await fetch(`${WORKER_URL}/api/admin/shop`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(shopData)
                });

                if (response.ok) {
                    // ã‚¿ã‚°ã‚’ç”Ÿæˆã—ã¦è¡¨ç¤º
                    const tagHtml = `&lt;script src="${WORKER_URL}/vai-tag.js" data-shop-id="${shopData.id}" data-plan="pro" defer&gt;&lt;/script&gt;`;
                    document.getElementById('tagCode').innerHTML = tagHtml;
                    document.getElementById('tagSection').classList.remove('hidden');
                    alert('åº—èˆ—æƒ…å ±ã®ä¿å­˜ã«æˆåŠŸã—ã¾ã—ãŸï¼ä¸‹éƒ¨ã«ã‚¿ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚');
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }
            } catch (error) {
                console.error(error);
                alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼: CORSè¨­å®šã¾ãŸã¯URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        });
    </script>
</body>
</html>
